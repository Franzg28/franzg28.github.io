<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Licorer√≠a</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #495057;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 25px;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }
        
        input, select, textarea {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .product-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s;
            background: white;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        
        .product-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        
        .product-name {
            font-size: 18px;
            font-weight: 700;
            color: #212529;
            margin-bottom: 8px;
        }
        
        .product-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .product-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .product-actions button {
            flex: 1;
            padding: 8px;
            font-size: 13px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 700;
            color: #495057;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: slideIn 0.3s;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .img-preview {
            max-width: 100%;
            max-height: 150px;
            margin-top: 10px;
            border-radius: 8px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .product-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .header h1 {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <!-- Pantalla de Login -->
    <div id="loginScreen" class="container" style="max-width: 500px; margin-top: 50px;">
        <div class="header">
            <h1>üîê Acceso al Sistema</h1>
            <p>Ingrese su contrase√±a</p>
        </div>
        <div style="padding: 30px;">
            <div id="loginAlert"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Contrase√±a</label>
                    <input type="password" id="passwordInput" placeholder="Ingrese su contrase√±a" required autofocus>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">üîì Ingresar</button>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; font-size: 14px;">
                <strong>‚ÑπÔ∏è Primera vez:</strong> La contrase√±a predeterminada es <code style="background: white; padding: 2px 8px; border-radius: 4px;">admin123</code>
                <br><br>
                Puede cambiarla despu√©s desde la secci√≥n de Backup.
            </div>
        </div>
    </div>

    <!-- Sistema Principal -->
    <div id="mainSystem" class="container" style="display: none;">
        <div class="header">
            <h1>üç∑ Sistema de Gesti√≥n de Licorer√≠a</h1>
            <p>Administra tu inventario de forma profesional</p>
            <button onclick="cerrarSesion()" style="position: absolute; right: 20px; top: 20px; background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 6px; cursor: pointer;">üö™ Cerrar Sesi√≥n</button>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('productos')">üì¶ Productos</button>
            <button class="tab" onclick="switchTab('agregar')">‚ûï Agregar Producto</button>
            <button class="tab" onclick="switchTab('ventas')">üí∞ Registrar Venta</button>
            <button class="tab" onclick="switchTab('reportes')">üìä Reportes</button>
            <button class="tab" onclick="switchTab('backup')">üíæ Backup</button>
        </div>
        
        <div id="productos" class="tab-content active">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Buscar producto por nombre, categor√≠a o c√≥digo..." oninput="searchProducts()">
            </div>
            <div id="productList" class="product-grid"></div>
        </div>
        
        <div id="agregar" class="tab-content">
            <h2 style="margin-bottom: 20px;">Agregar Nuevo Producto</h2>
            <div id="formAlert"></div>
            <form id="productForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>C√≥digo del Producto *</label>
                        <input type="text" id="codigo" required>
                    </div>
                    <div class="form-group">
                        <label>Nombre *</label>
                        <input type="text" id="nombre" required>
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a *</label>
                        <select id="categoria" required>
                            <option value="">Seleccione...</option>
                            <option value="Vinos">Vinos</option>
                            <option value="Cervezas">Cervezas</option>
                            <option value="Licores">Licores</option>
                            <option value="Whisky">Whisky</option>
                            <option value="Ron">Ron</option>
                            <option value="Vodka">Vodka</option>
                            <option value="Tequila">Tequila</option>
                            <option value="Champagne">Champagne</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Precio (Bs) *</label>
                        <input type="number" id="precio" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Cantidad en Stock *</label>
                        <input type="number" id="cantidad" required>
                    </div>
                    <div class="form-group">
                        <label>Stock M√≠nimo</label>
                        <input type="number" id="stockMin" value="5">
                    </div>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="descripcion" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Imagen del Producto</label>
                    <input type="file" id="imagen" accept="image/*" onchange="previewImage()">
                    <img id="imgPreview" class="img-preview">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">üíæ Guardar Producto</button>
                    <button type="button" class="btn btn-warning" onclick="resetForm()">üîÑ Limpiar</button>
                </div>
            </form>
        </div>
        
        <div id="ventas" class="tab-content">
            <h2 style="margin-bottom: 20px;">Registrar Venta</h2>
            <div id="ventaAlert"></div>
            <form id="ventaForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Seleccionar Producto *</label>
                        <select id="productoVenta" required onchange="updateVentaInfo()">
                            <option value="">Seleccione un producto...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Cantidad a Vender *</label>
                        <input type="number" id="cantidadVenta" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Stock Disponible</label>
                        <input type="text" id="stockDisponible" readonly style="background: #f8f9fa;">
                    </div>
                    <div class="form-group">
                        <label>Precio Unitario</label>
                        <input type="text" id="precioUnitario" readonly style="background: #f8f9fa;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Total de Venta</label>
                    <input type="text" id="totalVenta" readonly style="background: #f8f9fa; font-size: 20px; font-weight: bold; color: #28a745;">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-success">‚úÖ Registrar Venta</button>
                </div>
            </form>
        </div>
        
        <div id="reportes" class="tab-content">
            <h2 style="margin-bottom: 20px;">Reportes e Inventario</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalProductos">0</div>
                    <div class="stat-label">Total Productos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="valorInventario">0 Bs</div>
                    <div class="stat-label">Valor Inventario</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="ventasHoy">0</div>
                    <div class="stat-label">Ventas Hoy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="ingresoHoy">0 Bs</div>
                    <div class="stat-label">Ingresos Hoy</div>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="font-weight: 600; margin-bottom: 10px; display: block;">Filtrar Ventas por Per√≠odo:</label>
                <div class="btn-group">
                    <button class="btn btn-info" onclick="filtrarVentas('hoy')">Hoy</button>
                    <button class="btn btn-info" onclick="filtrarVentas('semana')">Esta Semana</button>
                    <button class="btn btn-info" onclick="filtrarVentas('mes')">Este Mes</button>
                    <button class="btn btn-info" onclick="filtrarVentas('todo')">Todo</button>
                </div>
            </div>
            
            <h3>Inventario Actual</h3>
            <div style="overflow-x: auto;">
                <table id="inventarioTable">
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Producto</th>
                            <th>Categor√≠a</th>
                            <th>Stock</th>
                            <th>Precio</th>
                            <th>Total</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="inventarioBody"></tbody>
                </table>
            </div>
            
            <h3 style="margin-top: 30px;">Historial de Ventas</h3>
            <div style="overflow-x: auto;">
                <table id="ventasTable">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Precio Unit.</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="ventasBody"></tbody>
                </table>
            </div>
        </div>
        
        <div id="backup" class="tab-content">
            <h2 style="margin-bottom: 20px;">Gesti√≥n de Datos</h2>
            
            <!-- Secci√≥n de Cambio de Contrase√±a -->
            <div style="background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                <h3 style="margin-bottom: 15px;">üîë Cambiar Contrase√±a</h3>
                <div id="passwordAlert"></div>
                <form id="changePasswordForm" style="margin-top: 15px;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Contrase√±a Actual</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label>Nueva Contrase√±a</label>
                            <input type="password" id="newPassword" required minlength="4">
                        </div>
                        <div class="form-group">
                            <label>Confirmar Nueva Contrase√±a</label>
                            <input type="password" id="confirmPassword" required minlength="4">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning">üîí Cambiar Contrase√±a</button>
                </form>
            </div>
            
            <div style="background: #d1ecf1; border: 1px solid #17a2b8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>üí° Importante:</strong> Exporta tus datos regularmente para hacer copias de seguridad. Puedes importar el archivo JSON en cualquier momento para restaurar tus datos.
            </div>
            
            <div class="btn-group">
                <button class="btn btn-success" onclick="exportarDatos()">üì• Exportar Datos (JSON)</button>
                <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">üì§ Importar Datos (JSON)</button>
                <button class="btn btn-danger" onclick="limpiarTodo()">üóëÔ∏è Limpiar Todo</button>
            </div>
            
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importarDatos(event)">
            
            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <h3>Informaci√≥n del Sistema</h3>
                <p><strong>Total de Productos:</strong> <span id="infoProductos">0</span></p>
                <p><strong>Total de Ventas Registradas:</strong> <span id="infoVentas">0</span></p>
                <p><strong>√öltima Actualizaci√≥n:</strong> <span id="infoFecha">-</span></p>
            </div>
        </div>
    </div>

    <script>
        let productos = [];
        let ventas = [];
        let editandoId = null;
        let sessionActiva = false;
        
        // Sistema de autenticaci√≥n
        function inicializarSistema() {
            // Verificar si ya hay contrase√±a guardada, si no, usar la predeterminada
            if (!localStorage.getItem('sistemaPassword')) {
                // Contrase√±a predeterminada: admin123 (en Base64 para ofuscaci√≥n b√°sica)
                localStorage.setItem('sistemaPassword', btoa('admin123'));
            }
            
            // Verificar si hay sesi√≥n activa
            const sesion = sessionStorage.getItem('sesionActiva');
            if (sesion === 'true') {
                iniciarSistema();
            }
        }
        
        document.getElementById('loginForm').onsubmit = function(e) {
            e.preventDefault();
            const password = document.getElementById('passwordInput').value;
            const passwordGuardada = atob(localStorage.getItem('sistemaPassword'));
            
            if (password === passwordGuardada) {
                sessionStorage.setItem('sesionActiva', 'true');
                iniciarSistema();
            } else {
                mostrarAlerta('loginAlert', '‚ùå Contrase√±a incorrecta', 'danger');
                document.getElementById('passwordInput').value = '';
            }
        };
        
        function iniciarSistema() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainSystem').style.display = 'block';
            sessionActiva = true;
            cargarDatos();
            actualizarProductoVenta();
            actualizarVistas();
        }
        
        function cerrarSesion() {
            if (confirm('¬øDesea cerrar sesi√≥n?')) {
                sessionStorage.removeItem('sesionActiva');
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('mainSystem').style.display = 'none';
                document.getElementById('passwordInput').value = '';
                sessionActiva = false;
            }
        }
        
        // Formulario de cambio de contrase√±a
        document.getElementById('changePasswordForm').onsubmit = function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            const passwordGuardada = atob(localStorage.getItem('sistemaPassword'));
            
            if (currentPassword !== passwordGuardada) {
                mostrarAlerta('passwordAlert', '‚ùå La contrase√±a actual es incorrecta', 'danger');
                return;
            }
            
            if (newPassword.length < 4) {
                mostrarAlerta('passwordAlert', '‚ùå La contrase√±a debe tener al menos 4 caracteres', 'danger');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                mostrarAlerta('passwordAlert', '‚ùå Las contrase√±as no coinciden', 'danger');
                return;
            }
            
            localStorage.setItem('sistemaPassword', btoa(newPassword));
            mostrarAlerta('passwordAlert', '‚úÖ Contrase√±a cambiada correctamente', 'success');
            
            document.getElementById('changePasswordForm').reset();
        };
        
        // Cargar datos al iniciar
        window.onload = function() {
            inicializarSistema();
        };
        
        function cargarDatos() {
            const datosGuardados = localStorage.getItem('licoreriaData');
            if (datosGuardados) {
                const datos = JSON.parse(datosGuardados);
                productos = datos.productos || [];
                ventas = datos.ventas || [];
            }
        }
        
        function guardarDatos() {
            const datos = {
                productos: productos,
                ventas: ventas,
                fecha: new Date().toISOString()
            };
            localStorage.setItem('licoreriaData', JSON.stringify(datos));
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'productos') {
                mostrarProductos();
            } else if (tabName === 'ventas') {
                actualizarProductoVenta();
            } else if (tabName === 'reportes') {
                actualizarReportes();
            } else if (tabName === 'backup') {
                actualizarInfoBackup();
            }
        }
        
        // Formulario de producto
        document.getElementById('productForm').onsubmit = function(e) {
            e.preventDefault();
            
            const producto = {
                id: editandoId || Date.now().toString(),
                codigo: document.getElementById('codigo').value,
                nombre: document.getElementById('nombre').value,
                categoria: document.getElementById('categoria').value,
                precio: parseFloat(document.getElementById('precio').value),
                cantidad: parseInt(document.getElementById('cantidad').value),
                stockMin: parseInt(document.getElementById('stockMin').value),
                descripcion: document.getElementById('descripcion').value,
                imagen: document.getElementById('imgPreview').src || '',
                fechaCreacion: editandoId ? productos.find(p => p.id === editandoId).fechaCreacion : new Date().toISOString()
            };
            
            if (editandoId) {
                const index = productos.findIndex(p => p.id === editandoId);
                productos[index] = producto;
                mostrarAlerta('formAlert', '‚úÖ Producto actualizado correctamente', 'success');
                editandoId = null;
            } else {
                // Verificar si el c√≥digo ya existe
                if (productos.some(p => p.codigo === producto.codigo)) {
                    mostrarAlerta('formAlert', '‚ùå El c√≥digo ya existe', 'danger');
                    return;
                }
                productos.push(producto);
                mostrarAlerta('formAlert', '‚úÖ Producto agregado correctamente', 'success');
            }
            
            guardarDatos();
            resetForm();
            actualizarVistas();
        };
        
        function previewImage() {
            const file = document.getElementById('imagen').files[0];
            const preview = document.getElementById('imgPreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        function resetForm() {
            document.getElementById('productForm').reset();
            document.getElementById('imgPreview').style.display = 'none';
            document.getElementById('imgPreview').src = '';
            editandoId = null;
        }
        
        function mostrarProductos(filtrados = null) {
            const lista = filtrados || productos;
            const container = document.getElementById('productList');
            
            if (lista.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #6c757d;">No hay productos registrados</p>';
                return;
            }
            
            container.innerHTML = lista.map(p => `
                <div class="product-card">
                    <img src="${p.imagen || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="200"%3E%3Crect fill="%23f8f9fa" width="200" height="200"/%3E%3Ctext x="50%25" y="50%25" font-size="20" text-anchor="middle" dy=".3em" fill="%236c757d"%3ESin imagen%3C/text%3E%3C/svg%3E'}" class="product-img" alt="${p.nombre}">
                    <div class="product-name">${p.nombre}</div>
                    <div class="product-info">
                        <span>üì¶ ${p.categoria}</span>
                        <span><strong>${p.codigo}</strong></span>
                    </div>
                    <div class="product-info">
                        <span>üí∞ ${p.precio.toFixed(2)} Bs</span>
                        <span style="${p.cantidad <= p.stockMin ? 'color: #dc3545; font-weight: bold;' : ''}">
                            Stock: ${p.cantidad}
                        </span>
                    </div>
                    ${p.descripcion ? `<p style="font-size: 13px; color: #6c757d; margin-top: 8px;">${p.descripcion}</p>` : ''}
                    <div class="product-actions">
                        <button class="btn btn-warning" onclick="editarProducto('${p.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="eliminarProducto('${p.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }
        
        function searchProducts() {
            const busqueda = document.getElementById('searchInput').value.toLowerCase();
            const filtrados = productos.filter(p => 
                p.nombre.toLowerCase().includes(busqueda) ||
                p.categoria.toLowerCase().includes(busqueda) ||
                p.codigo.toLowerCase().includes(busqueda)
            );
            mostrarProductos(filtrados);
        }
        
        function editarProducto(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;
            
            editandoId = id;
            document.getElementById('codigo').value = producto.codigo;
            document.getElementById('nombre').value = producto.nombre;
            document.getElementById('categoria').value = producto.categoria;
            document.getElementById('precio').value = producto.precio;
            document.getElementById('cantidad').value = producto.cantidad;
            document.getElementById('stockMin').value = producto.stockMin;
            document.getElementById('descripcion').value = producto.descripcion || '';
            
            if (producto.imagen) {
                document.getElementById('imgPreview').src = producto.imagen;
                document.getElementById('imgPreview').style.display = 'block';
            }
            
            switchTab('agregar');
            document.querySelectorAll('.tab')[1].classList.add('active');
        }
        
        function eliminarProducto(id) {
            if (confirm('¬øEst√° seguro de eliminar este producto?')) {
                productos = productos.filter(p => p.id !== id);
                guardarDatos();
                mostrarProductos();
                actualizarVistas();
            }
        }
        
        // Sistema de ventas
        function actualizarProductoVenta() {
            const select = document.getElementById('productoVenta');
            select.innerHTML = '<option value="">Seleccione un producto...</option>' +
                productos.filter(p => p.cantidad > 0).map(p => 
                    `<option value="${p.id}">${p.nombre} - Stock: ${p.cantidad}</option>`
                ).join('');
        }
        
        function updateVentaInfo() {
            const id = document.getElementById('productoVenta').value;
            if (!id) {
                document.getElementById('stockDisponible').value = '';
                document.getElementById('precioUnitario').value = '';
                document.getElementById('totalVenta').value = '';
                return;
            }
            
            const producto = productos.find(p => p.id === id);
            document.getElementById('stockDisponible').value = producto.cantidad;
            document.getElementById('precioUnitario').value = producto.precio.toFixed(2) + ' Bs';
            calcularTotal();
        }
        
        document.getElementById('cantidadVenta').oninput = calcularTotal;
        
        function calcularTotal() {
            const id = document.getElementById('productoVenta').value;
            const cantidad = parseInt(document.getElementById('cantidadVenta').value) || 0;
            
            if (id && cantidad > 0) {
                const producto = productos.find(p => p.id === id);
                const total = producto.precio * cantidad;
                document.getElementById('totalVenta').value = total.toFixed(2) + ' Bs';
            } else {
                document.getElementById('totalVenta').value = '';
            }
        }
        
        document.getElementById('ventaForm').onsubmit = function(e) {
            e.preventDefault();
            
            const productoId = document.getElementById('productoVenta').value;
            const cantidad = parseInt(document.getElementById('cantidadVenta').value);
            
            if (!productoId || !cantidad) {
                mostrarAlerta('ventaAlert', '‚ùå Complete todos los campos', 'danger');
                return;
            }
            
            const producto = productos.find(p => p.id === productoId);
            
            if (cantidad > producto.cantidad) {
                mostrarAlerta('ventaAlert', '‚ùå Stock insuficiente', 'danger');
                return;
            }
            
            // Registrar venta
            const venta = {
                id: Date.now().toString(),
                productoId: productoId,
                productoNombre: producto.nombre,
                cantidad: cantidad,
                precioUnitario: producto.precio,
                total: producto.precio * cantidad,
                fecha: new Date().toISOString()
            };
            
            ventas.push(venta);
            
            // Actualizar stock
            producto.cantidad -= cantidad;
            
            guardarDatos();
            mostrarAlerta('ventaAlert', `‚úÖ Venta registrada: ${cantidad} x ${producto.nombre} = ${venta.total.toFixed(2)} Bs`, 'success');
            
            document.getElementById('ventaForm').reset();
            actualizarProductoVenta();
            actualizarVistas();
        };
        
        function mostrarAlerta(containerId, mensaje, tipo) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert alert-${tipo}">${mensaje}</div>`;
            setTimeout(() => container.innerHTML = '', 4000);
        }
        
        // Reportes
        function actualizarReportes() {
            // Estad√≠sticas
            document.getElementById('totalProductos').textContent = productos.length;
            
            const valorTotal = productos.reduce((sum, p) => sum + (p.precio * p.cantidad), 0);
            document.getElementById('valorInventario').textContent = valorTotal.toFixed(2) + ' Bs';
            
            const hoy = new Date().toDateString();
            const ventasHoy = ventas.filter(v => new Date(v.fecha).toDateString() === hoy);
            document.getElementById('ventasHoy').textContent = ventasHoy.length;
            
            const ingresoHoy = ventasHoy.reduce((sum, v) => sum + v.total, 0);
            document.getElementById('ingresoHoy').textContent = ingresoHoy.toFixed(2) + ' Bs';
            
            // Tabla de inventario
            const tbody = document.getElementById('inventarioBody');
            tbody.innerHTML = productos.map(p => `
                <tr>
                    <td>${p.codigo}</td>
                    <td>${p.nombre}</td>
                    <td>${p.categoria}</td>
                    <td style="${p.cantidad <= p.stockMin ? 'color: #dc3545; font-weight: bold;' : ''}">${p.cantidad}</td>
                    <td>${p.precio.toFixed(2)} Bs</td>
                    <td>${(p.precio * p.cantidad).toFixed(2)} Bs</td>
                    <td>
                        ${p.cantidad <= p.stockMin ? 
                            '<span style="background: #dc3545; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px;">‚ö†Ô∏è Bajo</span>' : 
                            '<span style="background: #28a745; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px;">‚úì OK</span>'}
                    </td>
                </tr>
            `).join('');
            
            // Tabla de ventas (todas por defecto)
            filtrarVentas('todo');
        }
        
        function filtrarVentas(periodo) {
            const ahora = new Date();
            let ventasFiltradas = ventas;
            
            if (periodo === 'hoy') {
                ventasFiltradas = ventas.filter(v => 
                    new Date(v.fecha).toDateString() === ahora.toDateString()
                );
            } else if (periodo === 'semana') {
                const inicioDeSemana = new Date(ahora);
                inicioDeSemana.setDate(ahora.getDate() - ahora.getDay());
                ventasFiltradas = ventas.filter(v => new Date(v.fecha) >= inicioDeSemana);
            } else if (periodo === 'mes') {
                ventasFiltradas = ventas.filter(v => 
                    new Date(v.fecha).getMonth() === ahora.getMonth() &&
                    new Date(v.fecha).getFullYear() === ahora.getFullYear()
                );
            }
            
            const tbody = document.getElementById('ventasBody');
            
            if (ventasFiltradas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #6c757d;">No hay ventas en este per√≠odo</td></tr>';
                return;
            }
            
            tbody.innerHTML = ventasFiltradas.reverse().map(v => `
                <tr>
                    <td>${new Date(v.fecha).toLocaleString('es-ES')}</td>
                    <td>${v.productoNombre}</td>
                    <td>${v.cantidad}</td>
                    <td>${v.precioUnitario.toFixed(2)} Bs</td>
                    <td style="font-weight: bold; color: #28a745;">${v.total.toFixed(2)} Bs</td>
                </tr>
            `).join('');
        }
        
        // Backup
        function exportarDatos() {
            const datos = {
                productos: productos,
                ventas: ventas,
                fecha: new Date().toISOString(),
                version: '1.0'
            };
            
            const json = JSON.stringify(datos, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `licoreria_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Datos exportados correctamente');
        }
        
        function importarDatos(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const datos = JSON.parse(e.target.result);
                    
                    if (!datos.productos || !Array.isArray(datos.productos)) {
                        alert('‚ùå Archivo JSON inv√°lido');
                        return;
                    }
                    
                    if (confirm('‚ö†Ô∏è ¬øDesea reemplazar todos los datos actuales con los del archivo?\n\nEsto eliminar√° todos los datos existentes.')) {
                        productos = datos.productos;
                        ventas = datos.ventas || [];
                        guardarDatos();
                        actualizarVistas();
                        alert('‚úÖ Datos importados correctamente');
                    }
                } catch (error) {
                    alert('‚ùå Error al leer el archivo: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
        
        function limpiarTodo() {
            if (confirm('‚ö†Ô∏è ¬øEST√Å SEGURO?\n\nEsto eliminar√° TODOS los productos y ventas permanentemente.\n\nRecomendamos exportar sus datos antes de continuar.')) {
                if (confirm('‚ö†Ô∏è √öLTIMA CONFIRMACI√ìN\n\n¬øRealmente desea eliminar todo?')) {
                    productos = [];
                    ventas = [];
                    localStorage.removeItem('licoreriaData');
                    actualizarVistas();
                    alert('‚úÖ Todos los datos han sido eliminados');
                }
            }
        }
        
        function actualizarInfoBackup() {
            document.getElementById('infoProductos').textContent = productos.length;
            document.getElementById('infoVentas').textContent = ventas.length;
            
            const datosGuardados = localStorage.getItem('licoreriaData');
            if (datosGuardados) {
                const datos = JSON.parse(datosGuardados);
                document.getElementById('infoFecha').textContent = new Date(datos.fecha).toLocaleString('es-ES');
            } else {
                document.getElementById('infoFecha').textContent = 'Sin datos guardados';
            }
        }
        
        function actualizarVistas() {
            mostrarProductos();
            actualizarProductoVenta();
        }
    </script>
</body>
</html>